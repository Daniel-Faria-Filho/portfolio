<%- include('partials/header') %>

<div class="billing-container">
    <h1>Billing Management</h1>
    
    <div class="subscription-card">
        <h2>Your Subscriptions</h2>
        <% if (user.subscriptions && user.subscriptions.length > 0) { %>
            <% user.subscriptions.forEach(subscription => { %>
                <div class="subscription-item">
                    <h3><%= subscription.name %></h3>
                    <p>Status: <%= subscription.status %></p>
                </div>
            <% }) %>
        <% } else { %>
            <p>No active subscriptions</p>
        <% } %>
    </div>

    <div class="recent-invoices">
        <h2>Recent Invoices</h2>
        <% if (invoices && invoices.length > 0) { %>
            <div class="invoices-list">
                <% invoices.forEach(invoice => { %>
                    <div class="invoice-item">
                        <div class="invoice-details">
                            <span class="invoice-date">
                                <%= new Date(invoice.createdAt).toLocaleDateString() %>
                            </span>
                            <span class="invoice-amount">
                                $<%= (invoice.amount / 100).toFixed(2) %>
                            </span>
                            <span class="invoice-status <%= invoice.status %>">
                                <%= invoice.status %>
                            </span>
                        </div>
                        <a href="/invoice/<%= invoice._id %>" class="view-invoice">
                            View Invoice
                        </a>
                    </div>
                <% }); %>
            </div>
        <% } else { %>
            <p>No invoices yet</p>
        <% } %>
    </div>

    <div class="payment-method-section">
        <h3>Payment Methods</h3>
        <div id="card-element"></div>
        <button id="save-card-button">Save Card</button>
    </div>
</div>

<script src="https://js.stripe.com/v3/"></script>
<script src="/js/billing.js"></script>
<script>
    const stripe = Stripe('<%- stripePublicKey %>');
    const elements = stripe.elements();
    const card = elements.create('card');
    card.mount('#card-element');
</script>

<%- include('partials/footer') %> 